<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <link href="/css/styles.css" rel="stylesheet" />
  <link href="/css/map.css" rel="stylesheet" />
  <link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.3/mapbox.css' rel='stylesheet' />
  <script src="js/app.js"></script>
</head>
<body class="loading">
  
  <!-- Leaflet.js map -->
  <div id='map'></div>

  <!-- Menu -->
  <div id='selections' class="selections">
    <div class='content'>
      
      <!-- Select Data Sets -->

      <div id="toggles"></div>
      <a href="#" id="toggleConnections">Toggle Connections</a>

      <!-- Filter Data -->

      <label>Filter By:</label>
      <select id="month">
        <option>All Months</option>
        <option>1</option>
        <option>2</option>
        <option>3</option>
        <option>4</option>
        <option>5</option>
        <option>6</option>
        <option>7</option>
        <option>8</option>
        <option>9</option>
        <option>10</option>
        <option>11</option>
        <option>12</option>
      </select>
      <select id="day">
        <option>All Days</option>
      </select>
      <div>
        <button id="dateFilter">Filter</button>
        <button onclick="clearFilter()">Clear Filter</button>
      </div>
    </div>
  </div>

  <div id='loading'></div>

  <script>

    /****************************
            Settings
     ****************************/
    
    // Map settings
    var options = {
        
        // Mapbox's style key for applying map designs
        map_key: "stephalee.aec4ccea",
        
        // Pixel width of scatterplot points
        dot_width: 4,

        // Toggle path "web" of connections
        map_show_connections : false,  
        
        // Should the map connect-the-dots upon hovering
        // over a specific point
        show_paths_on_hover: false,

        // Define default map viewport: Top left & bottom right coordinates
        viewport: [[42.329077, -71.108871], [42.374200, -71.032072]],

        // Define our data source ('json', 'xml', 'api')
        data_source : "xml",
    } 

    // Save the raw data to a global file.
    // Since we'll be manipulating, and filtering our
    // data set, we'll want to keep and original copy
    // as to avoid re-fetching ALL our data when we
    // reset filters.

    var raw_data = null;

    /****************************
            Initialize
     ****************************/
    
    // On document ready
    $(function() {

      // Load location data.
      loadData(options.data_source, function(data){

        raw_data = data;
        console.log(raw_data);

        // Initialize Leaflet map
        map = L.mapbox.map('map', options.map_key).fitBounds(options.viewport);
        
        // format data
        var data = formatData(data, "time");

        // Render points on graph
        drawPoints(map, data);
      })
    });

    /****************************
            Interaction
     ****************************/    

    // Show/Hide sequential lines
    $("#toggleConnections").click(function(){
      options.map_show_connections = !options.map_show_connections;
      d3.selectAll("line").style("opacity", options.map_show_connections ? 1 : 0);
    });

    /******************************
             Watchers
     ******************************/

    $("#month").change(function(){
      makeDays($("#month").val());
    });

    $("#dateFilter").click(function(){
      filter($("#month").val(), $("#day").val());
    });

  </script>
  <script src="https://api.tiles.mapbox.com/mapbox.js/v1.6.3/mapbox.js"></script>
</body>
</html>
