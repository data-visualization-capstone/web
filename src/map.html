<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/css/style.css" rel="stylesheet" />
  <link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.3/mapbox.css' rel='stylesheet' />
  <title>Data Visualization Capstone</title>
</head>

<body id="map-content" class="loading">

  <!-- Leaflet.js map -->
  <div id='map'></div>

  <div id="filterMenu" style="display: none;">
    <div id="fmToggle">
      <a href="javascript:void(0)">
        <h4>Data Filters</h4>
      </a>
    </div>

    <div id="filterMenuBody">
      <div id="filterMenuBodyInner">
        <form action="#">
          <!-- Select Data Sets -->
          <div id="toggles" style="display: none;"></div>
  
          <section id="dateSection">
            <h4>by Date:</h4>

            <!-- Toggle Date Filtering
            <div class="checkbox_outer">
              <input checked type="checkbox" name="date" value="anyDate">
              <label>Any Date</label>
            </div>

            <div class="checkbox_outer">
              <input checked type="checkbox" name="date" value="dateRange">
              <label>Date Range</label>
            </div>-->

            <!-- Filter Data -->
            <div class="demo">
              <input id="date-range" value="" style="width: 100%;">
            </div>


            <div class="divider clear"></div>

            <section id="timeSection">
              <h4>by Time:</h4>

              <div id="slider"></div>

              <div class="divider"></div>

              <h4>MAP TYPE</h4>

              <div class="inputGroup">
                <div class="checkbox_outer">
                  <input type="checkbox" name="time" value="heatmap" checked>
                  <label>Heatmap</label>
                </div>
              </div>

              <div class="inputGroup">
                <div class="checkbox_outer">
                  <input type="checkbox" name="time" value="chronological">
                  <label>Chronological</label>
                </div>
              </div>

              <div class="inputGroup">
                <div class="checkbox_outer">
                  <input type="checkbox" name="time" value="plain">
                  <label>Plain</label>
                </div>
              </div>

            </section>
      </div>
      </form>
    </div>
  </div>

  <div id='loading'></div>

  <!-- Custom -->
  <script src="js/app.js"></script>
  <script src="js/sample-data.js"></script>
	
  <!-- External -->
  <script src="https://api.tiles.mapbox.com/mapbox.js/v1.6.3/mapbox.js"></script>
  <script src='js/heatmap/webgl-heatmap.js'></script>
  <script src='js/heatmap/webgl-heatmap-leaflet.js'></script>

  <script>

    /************************************
         Data Visualization Settings
     ************************************/

    // Map settings
    var options = {

      // Mapbox's style key for applying map designs
      map_key: "stephalee.aec4ccea",

      // Pixel width of scatterplot points
      dot_width: 3,

      // Toggle path "web" of connections
      map_show_connections: true,

      // Should the map connect-the-dots upon hovering
      // over a specific point
      show_paths_on_hover: false,

      // Define default map viewport: Top left & bottom right coordinates
      viewport: [
        [42.329077, -71.108871],
        [42.374200, -71.032072]
      ],

      // Define our data source ('json', 'xml', 'api')
      data_source: "json",
      data_file: "data/json/alex.json",

      // Trim Data Set?
      // Takes first X data entries. null for no trim
      data_splice: null,

      // Take Sample from Data Set?
      // Randomly selects X entries. null for no sampling
      data_sample: 1000,

      // Active data filters
      filters: {

        // Oldest plotted point
        startdate: null,

        // Most recent plotted point
        enddate: null,

        // How should dots be colored?
        colorBy: 'time',
      },

      
      // Support multiple layers of data representation.
      // Useful for building correlations between data sets.
      layers : [{
        
        // Define representation of layer
        type : "heatmap",

        // Data from sample-data.js
        data : apartments,

      },{}],
    }

	// On document ready
	$(function() {

	  // Load location data.
	  loadData(options.data_source, function(data) {

	    // Splice the data set for efficiency?
	    if (options.data_splice) {
	      data = data.splice(0, options.data_splice);
	    }

	    // Sample the data set for efficiency?
	    if (options.data_sample) {

	      // Take random sample of data
	      data = _.sample(data, options.data_sample);

	      // Sort by date
	      data = _.sortBy(data, function(p) {
	        return p.date
	      });
	    }

	    // Check for missing keys
	    data = removeInvalidData(data, ["latitude", "longitude", "date"])

	    // Save data. The only time RAW and FILTERED data will be the same.
	    raw_data = filtered_data = formatData(data, "time");

	    // Setup date ranger picker.
	    initDateRangePicker(filtered_data[0].date, filtered_data[filtered_data.length - 1].date);

	    // Render the current filtered subset of data
	    draw(filtered_data);
	  })
	});

  </script>
</body>

</html>