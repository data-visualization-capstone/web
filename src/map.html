<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="/css/style.css" rel="stylesheet" />
  <link href='https://api.tiles.mapbox.com/mapbox.js/v1.6.3/mapbox.css' rel='stylesheet' />
  <title>Data Visualization Capstone</title>
</head>

<body id="map-content" class="loading">

  <!-- Leaflet.js map -->
  <div id='map'></div>

  <div id="filterMenu" style="display: none;">
    <div id="fmToggle">
      <a href="javascript:void(0)">
        <h4>Data Filters</h4>
      </a>
    </div>

    <div id="filterMenuBody">
      <div id="filterMenuBodyInner">
        <form action="#">
          <!-- Select Data Sets -->
          <div id="toggles" style="display: none;"></div>
  
          <section id="dateSection">
            <h4>by Date:</h4>

            <!-- Toggle Date Filtering
            <div class="checkbox_outer">
              <input checked type="checkbox" name="date" value="anyDate">
              <label>Any Date</label>
            </div>

            <div class="checkbox_outer">
              <input checked type="checkbox" name="date" value="dateRange">
              <label>Date Range</label>
            </div>-->

            <!-- Filter Data -->
            <div class="demo">
              <input id="date-range" value="" style="width: 100%;">
            </div>


            <div class="divider clear"></div>

            <section id="timeSection">
              <h4>by Time:</h4>

              <div id="slider"></div>

              <div class="divider"></div>

              <h4>MAP TYPE</h4>

              <div class="inputGroup">
                <div class="checkbox_outer">
                  <input type="checkbox" name="time" value="heatmap" checked>
                  <label>Heatmap</label>
                </div>
              </div>

              <div class="inputGroup">
                <div class="checkbox_outer">
                  <input type="checkbox" name="time" value="chronological">
                  <label>Chronological</label>
                </div>
              </div>

              <div class="inputGroup">
                <div class="checkbox_outer">
                  <input type="checkbox" name="time" value="plain">
                  <label>Plain</label>
                </div>
              </div>

            </section>
      </div>
      </form>
    </div>
  </div>

  <div id='loading'></div>

  <!-- Custom -->
  <script src="js/app.js"></script>
  <script src="js/sample-data.js"></script>
	
  <!-- External -->
  <script src="https://api.tiles.mapbox.com/mapbox.js/v1.6.3/mapbox.js"></script>
  
  <script src='js/heatmap/webgl-heatmap.js'></script>
  <script src='js/heatmap/webgl-heatmap-leaflet.js'></script>
  
  <script src='js/heatmap/leaflet-d3.js'></script>
  <script src='js/heatmap/hexbin.js'></script>
  

  <script>

    /************************************
         Data Visualization Settings
     ************************************/

    // Map settings
    var options = {

      // Mapbox's style key for applying map designs
      map_key: "stephalee.aec4ccea",

      // Define default map viewport: Top left & bottom right coordinates
      viewport: [
        [42.329077, -71.108871],
        [42.374200, -71.032072]
      ],

      // Active data filters
      filters: {

        // Oldest plotted point
        startdate: null,

        // Most recent plotted point
        enddate: null,

      },

      // Support multiple layers of data representation.
      // Useful for building correlations between data sets.
      layers : [],
        
    }

    // Add Default Layers
    options.layers.push({
  		type: "scatterplot-temp-remove",
  		data : sample_data.google_location_history,
  		
  		// Pixel width of scatterplot points
  		dot_width: 3,
  	});

   //  options.layers.push({

   //      // Define representation of layer
   //      type : "scatterplot",

   //      // Data from sample-data.js
   //      data : sample_data.subway.orange,

   //      // Default color
   //      color: "#ffa500",
  	// });
	
	  options.layers.push({

        // Define representation of layer
        type : "heatmap",

        // Data from sample-data.js
        data : sample_data.apartments,
  	});

  // Global variable for map object
  // Initialize Leaflet map
  var leaflet_map = L.mapbox.map('map', options.map_key).fitBounds(options.viewport);

	// On document ready
	$(function() {

    // Render Data Layers
    // addLayers();

	});


  // http://bost.ocks.org/mike/leaflet/
  $(function(){

    var map = leaflet_map;

    // Map limits
    var bounds = leaflet_map.getBounds();
    var topLeft = map.latLngToLayerPoint(bounds.getNorthWest());
    var bottomRight = map.latLngToLayerPoint(bounds.getSouthEast());

    // Select leaflet's 'overlay pane' layer.
    // Leaflet auto-repositions the overlay panes
    // upon map movement.
    // Add an svg element
    var svg = d3.select(leaflet_map.getPanes().overlayPane).append("svg");

    // Fix the size of our SVG layer to match the leaflet map
    var svg = d3.select(map.getPanes().overlayPane).append("svg")
      .attr('id', 'overlay')
      .attr("class", "leaflet-zoom-hide")
      .style("width",  map.getSize().x + 'px')
      .style("height", map.getSize().y + 'px')

    // New "g" (group) element.
    // Used to keep D3.js elements aligned with
    // the origin of the map.

    // Apply leaflet-zoom-hide so that the overlay
    // is hidden during zoom animations
    var g = svg.append("g").attr("class", "leaflet-zoom-hide");

    var points = sample_data.apartments;
      
    // Create map-able set of points
    // For each point, fix the x and y 
    points = points.filter(function(p) {

      // Create new leaflet Lat/Long Object
      var latlng = new L.LatLng(p.latitude, p.longitude);

      // Remove points that are missing a GPS location
      if (!bounds.contains(latlng)) { return false };
      
      // Convert Lat & Long into a Mapable point.
      // Use Leaflet's latLngToLayerPoint() to create a single point
      var point = leaflet_map.latLngToLayerPoint(latlng);

      p.x = point.x;
      p.y = point.y;

      return true;
    });

    console.log(points);

    var svgPoints = g.attr("class", "points")
      .selectAll("g")
      .data(points)
      .enter().append("g")
      .attr("class", "point")
      .style("z-index", 999);

    // Add circles for each point
    svgPoints.append("circle")
      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })
      .style('fill', function(d) { return '#' + d.color } )
      .attr("date", function(d) { return d.date })
      .attr("r", 3)
      .attr("pointer-events", "all")
      .attr("opacity", 1);



  });
   
    

  </script>
</body>

</html>









